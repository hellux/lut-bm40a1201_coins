\documentclass[report.tex]{subfile}

\begin{document}

\section{Method}
%Method Intro - Need - How it was done?

\subsection{Image Preprocessing}
The given initial set of images consists of varying number of coins against a
checkerboard background. Often these images are bereft with noises due to
cross-talk,pixel sensitivities and bias. Intensity calibration is useful
technique that can be applied to these images to eliminate these errors:

\begin{equation*}
    R_{\textrm{cal}} = \frac{R - \overline{B} - \overline{D}}{\hat{F}}
\end{equation*}

The $R_{\textrm{cal}}$ is the resulting calibrated image. $R$ is the raw image
whereas $\overline{B}$ and $\overline{D}$ are the mean of the provided bias and
dark images. $\hat{F}$ is the sum of all the flat field images normalized to
have a mean of 1 which is calculated using the mean $\overline{F}$ as
$\frac{\overline{F}}{\norm{\overline{F}}}$. However, the presence of
checkerboard adds some difficulty to the calibration specifically in those
cases when the coins are covering the checkerboard area. To counteract the
presence of the checkerboards on such coins we eliminated the checkerboard from
the flat field image while calibrating the image.

An additional calibration step is also needed to convert the measurements
obtained by the camera to real world measurements. This is essential because it
may be that not all the different types of coins will be present in all the
images. Implying, using relative comparison between the largest and smallest
coin in an image would not be an ideal scheme and lead to errors in this case.
Hence we proceeded to derive the scaling factor for conversion from camera
coordinates to real-world coordinates and hence obtain the diameters of the
coins that are quite close in comparison to their real world counterparts. To
achieve spatial calibration we make use of the checkerboard as its boxes are
known to be of an already measured size. To account for errors in checkerboard
points estimation by the in-built MATLAB function we take the mean of the
normalized length along each of the inner edge of the board points divided by
the number of detected squares along that edge.

\subsection{Coin Segmentation}
For segregating the coin from the background we adopt a similar approach of
checkerboard removal as the checkerboard has significant effect on determining
the threshold for binarizing the image. Otsu's method is used to obtain a
threshold when the checkerboard is removed. The binarization is then performed
with that threshold on the original image. The binary image is then opened and
closed morphologically to remove spots within the coins. Finally, the circles
of the coins are found using the imfindcircles MATLAB function. The function
uses circular Hough transform with Atherton and Kerbyson's phase coding method
to detect the circles \cite{matlab-imfindcircles}.

\subsection{Feature Extraction}
In total, three features are used to classify the different coins;
\begin{itemize}
    \item the diameter of the coin,
    \item the average hue of the coin, weighted by the saturation, and
    \item difference of the average saturation of the inner and outer part of
        the coin.
\end{itemize}
The diameter is calculated by taking the number of pixels and scaling it
according to the above mentioned geometric calibration in order to get a length
in millimeters.

The weigthed averaged $\mean{h}$ of the hue is calculated by taking the sum of
all the hues multiplied by all the saturations, and dividing it by the total
saturation as
\begin{equation*}
    \mean{h} = \frac{\sum_i^N h_i s_i}{\sum_i^N s_i},
\end{equation*}
where $h_i$, $s_i$ is the hue and saturation of the $i$:th pixel within the
coin.

The saturation difference is calculated by taking the average saturation of the
inner pixels subtracted by the average saturation of the outer pixels. Pixels
within 80\% of the radius are considered inner and the rest of the pixels
within the coin are considered outer pixels.

\subsection{Classification}



\end{document}
